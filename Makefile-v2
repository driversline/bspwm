all: install

install: packages directories dotfiles permissions additional manager

packages = bspwm alacritty sxhkd ranger neovim picom feh gnome-keyring xorg-xsetroot xorg-xrandr ttf-dejavu
directories = $(HOME)/.config/bspwm $(HOME)/.config/picom $(HOME)/.config/alacritty
dotfiles = \
	$(HOME)/bspwm/dotfiles/bspwmrc \
	$(HOME)/bspwm/dotfiles/sxhkdrc \
	$(HOME)/bspwm/dotfiles/picom.conf \
	$(HOME)/bspwm/dotfiles/alacritty.toml \
	$(HOME)/bspwm/dotfiles/.xsession
permissions = \
	$(HOME)/.config/bspwm/bspwmrc \
	$(HOME)/.xsession \
	$(HOME)/bspwm/scripts/*.sh \
	$(HOME)/bspwm/firefox/*.sh

additional_commands = \
	"1=git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si --noconfirm" \
	"2=yay -S --noconfirm cava" \
	"3=yay -S --noconfirm spotify" \
	"4=sudo pacman -S --noconfirm neofetch" \
	"5=yay -S --noconfirm openrgb" \
	"6=sudo pacman -S --noconfirm jdk-openjdk" \
	"7=sudo pacman -S --noconfirm gradle"

packages:
	@set -e; \
	install_package() { \
		if ! pacman -Q "$1" > /dev/null 2>&1; then \
			sudo pacman -S --noconfirm "$1"; \
		fi; \
	}; \
	for pkg in $(packages); do \
		install_package "$pkg"; \
	done

directories:
	@for dir in $(directories); do \
		mkdir -p "$dir"; \
	done

dotfiles:
	@for src in $(dotfiles); do \
		dest=$(HOME)/.config/bspwm; \
		[ "$src" = "$(HOME)/bspwm/dotfiles/alacritty.toml" ] && dest=$(HOME)/.config/alacritty; \
		[ -f "$src" ] && mv "$src" "$dest"; \
	done

permissions:
	@for file in $(permissions); do \
		[ -f "$file" ] && chmod +x "$file"; \
	done

additional:
	@echo -e "Additional packages for installation:\n1 | yay\n2 | cava\n3 | spotify\n4 | neofetch\n5 | openrgb\n6 | openjdk\n7 | gradle"
	@read -p "Enter package numbers for installation: " -a selected_additional_indices; \
	for index in ${selected_additional_indices[@]}; do \
		cmd=$(echo $(additional_commands) | grep -oP "$index=\K[^ ]+"); \
		if [[ -n "$cmd" ]]; then \
			eval "$cmd"; \
		else \
			echo "Incorrect number: $index"; \
		fi; \
	done

manager:
	sudo pacman -S --noconfirm ly && sudo systemctl enable ly.service

	@echo "Excellent. You can reboot the system."

.PHONY: all install packages directories dotfiles permissions additional manager
